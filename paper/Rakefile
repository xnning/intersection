# -*- coding: utf-8 -*-

task :default => :paper

desc "Prepare rules"
  task :prepare_rules do
    system <<-SHELL
cd rules
cp trans-get.tex fi-get.tex &&
cp trans-put.tex fi-put.tex &&
cp trans-sub.tex fi-sub.tex &&
cp trans-typing.tex fi-typing.tex &&
sed -i 's/\\optional/\\optionalnothing/g'     fi-*.tex &&
sed -i 's/\\yields/\\yieldsnothing/g'     fi-*.tex &&
cd -
    SHELL
end

desc "Make the paper"
task :paper => :prepare_rules do
  # From the documentation of the minted package:
  # "Since minted makes calls to the outside world (i.e. Pygments), you need to
  # tell the LaTeX processor about this by passing it the -shell-escape option
  # or it wonâ€™t allow such calls."
  latex = "pdflatex -shell-escape"
  # filenames     = Dir["sections/*.tex"]
  # system("runhaskell Include.hs #{filenames.join(' ')} && pdflatex #{latex_options.join(' ')} main.tex")
  system <<-SHELL
#{latex} main.tex &&
bibtex   main &&
#{latex} main.tex &&
#{latex} main.tex
  SHELL
end

desc "Remove generated Java source files"
task :clean do
  system("rm -f ../src/*.java")
end
