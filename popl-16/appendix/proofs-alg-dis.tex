\subsection{Soundness and Completeness of Algorithmic Disjointness}

Some ways to rule out the possibility of disjointness.

\begin{itemize}
  \item If one type is a subtype of the other, then they cannot be disjoint.
  \item If the set of free type variables of two types overlap, then they cannot
  be disjoint.
\end{itemize}

\begin{lemma}
  If $A$ and $B$ are two types and $\ftv A \cap \ftv B \neq \varnothing$, then
  there does not exist a $\Gamma$ such that $\jdis \Gamma A B$.
\end{lemma}

\begin{theorem}
  If $A \subtype C$, then $A \inter B \subtype C$.
  If $B \subtype C$, then $A \inter B \subtype C$.
\end{theorem}

\george{Add interpretation of the theorem}

\begin{proof}
  By induction on $C$.
  If $C \neq E_1 \inter E_2$, trivial.
  If $C = E_1 \inter E_2$,
  Need to show $A \subtype E_1 \inter E_2$ implies $A \inter B \subtype E_1 \inter E_2$.
  By inversion $A \subtype E_1$ and $A \subtype E_2$.
  By the i.h., $A \inter B \subtype E_1$ and $A \inter B \subtype E_2$.
  By \reflabel{\labelsubinter}, $A \inter B \subtype E_1 \inter E_2$.
\end{proof}

\begin{lemma}{Symmetry of disjointness}
  \label{lemma:symmetry-of-disjointness}

  If $\jdis \Gamma A B$, then $\jdis \Gamma B A$.
\end{lemma}

\begin{proof}
  Trivial by the definition of disjointness.
\end{proof}

\begin{theorem}
  \label{theorem:disjoint-intersect}

  If $\jdis \Gamma A C$ and $\jdis \Gamma B C$,
  then $\jdis \Gamma {A \inter B} {C}$.
\end{theorem}

\begin{lemma}
  \label{lemma:common-supertype}

  If $A_1 \to A_2 \subtype D$ and $B_1 \to B_2 \subtype D$,
  then there exists a $C$ such that $A_2 \subtype C$ and $B_2 \subtype C$.
\end{lemma}

\begin{proof}
  By induction on $D$.
\end{proof}

\begin{lemma}
  \label{lemma:subtype-ftv}

  If $\alpha \subtype A$, then $\alpha \in \ftv A$.
\end{lemma}

\begin{proof}
  Straightforward by checking the subtyping rules.
\end{proof}

\algodissoundness*

\begin{proof}
  \george{State the definition of disjointness more clearly in the text.}

  We need to show that $A$ and $B$ are disjoint in $\Gamma$. The proof is by
  induction on the derivation of $\jdisimpl \Gamma A B$.

  \begin{itemize}
    \item Case
    \begin{flalign*}
      & \ruledisvar &
    \end{flalign*}

    Suppose the contrary. Then by the definition of disjointness, there exists a
    type $B$ such that $\alpha \subtype B$ and $A \subtype B$. By
    Lemma~\ref{lemma:subtype-ftv}, $\alpha \in \ftv B$. Combining the fact that
    $A \subtype B$, we also have $\alpha \in \ftv A$. But by the typing rules,
    we know $\alpha \not \in \ftv A$. Contradiction. \\

    \item Case
    \begin{flalign*}
      & \ruledissym &
    \end{flalign*}

    Similar. \\

    \item Case
    \begin{flalign*}
      & \ruledisfun &
    \end{flalign*}

    Suppose the contrary. Then by the definition of disjointness, there exists a
    type $A$ such that $A_1 \to A_2 \subtype A$ and that $B_1 \to B_2 \subtype
    A$. Therefore by Lemma~\ref{lemma:common-supertype} we know $A_2 \subtype A$
    and $B_2 \subtype A$. That is, $A_2$ and $B_2$ are not disjoint. But by
    inversion, we must have $\jdisimpl \Gamma {A_2} {B_2}$ and further by the
    i.h., $\jdis \Gamma {A_2} {B_2}$, which contradicts with the above
    consequence that $A_2$ and $B_2$ are not disjoint.

    \george{May need an extracted lemma here.} \\

    \item Case
    \begin{flalign*}
      & \ruledisforall &
    \end{flalign*}

    Suppose the contrary. Then by the definition of disjointness, there exists a
    type $C$ such that $\fordis \alpha {A_1} {A_2} \subtype A$ and that $\fordis
    \alpha {B_1} {B_2} \subtype A$. By the subtyping rules, $A$ must be of the
    form $\fordis \alpha {C_1} {C_2}$. Thus, \[ \fordis \alpha {A_1} {A_2}
    \subtype \fordis \alpha {C_1} {C_2} \] and by inversion, $A_2 \subtype C_2$.
    Similarly $B_2 \subtype C_2$. But by inversion we must have $\jdisimpl
    \Gamma {A_2} {B_2}$ and by the i.h. $\jdis \Gamma {A_2} {B_2}$. A
    contradiction similar to the above case arises.

    \item Case
    \begin{flalign*}
      & \ruledisinterl &
    \end{flalign*}

    By Lemma~\ref{lemma:disjoint-intersect} and the i.h. \\

    \item Case
    \begin{flalign*}
      & \ruledisinterr &
    \end{flalign*}

    By Lemma~\ref{lemma:disjoint-intersect}, Lemma~\ref{lemma:symmetry-of-disjointness}, and the i.h. \\

    \item Case
    \begin{flalign*}
      & \ruledisatomic &
    \end{flalign*}

    Straightforward.

    % Need to show ...
    % By unfolding the definition of disjointness
    % Need to show there does not exists $C$ such that...
    % By induction on $C$.
    % Atomic cases...
    % If $C = E_1 \inter E_2$
    % By inversion and the i.h. we arrive at a contradiction.

  \end{itemize}
\end{proof}


\algodiscompleteness*

\begin{proof}

  Consider the combinations of the shape of $A$ and $B$. If $A$ and $B$ are of
  different shape and neither of them is an intersection type, then by the
  disjoint axioms we already can conclude that $A \disjointax B$. Thus by
  \reflabel{\labeldisax}, $\jdisimpl \Gamma A B$. The other cases are as
  follow.

  \begin{itemize}
    \item Case $A = \bot$:
    \begin{itemize}
      \item Case $B = \bot$: Trivial.

      \item Case $B = B_1 \inter B_2$: Need to show $\jdis \Gamma \bot {B_1}
      \inter B_2$ implies $\jdisimpl \Gamma \bot {B_1 \inter B_2}$. Apply
      \reflabel{\labeldisinterr} and the resulting conditions can be proved by
      the i.h.
    \end{itemize}

    \item Case $A = A_1 \to A_2$:

    \begin{itemize}

      \item Case $B = B_1 \to B_2$:
      Need to show $\Gamma \turns A_1 \to A_2 * B_1 \to B_2$ implies
      $\Gamma \turns  A_1 \to A_2 *_I B_1 \to B_2$. Apply
      \reflabel{\labeldisfun} and the result, $\Gamma \turns A_2 *_I B_2$,
      can be proved by the i.h.

      \item Case $B = B_1 \inter B_2$: Need to show $\Gamma \turns A_1 \to
      A_2 * B_1 \inter B_2$ implies $\Gamma \turns A_1 \to A_2 *_I B_1
      \inter B_2$. Apply \reflabel{\labeldisinterr} and the resulting
      conditions can be proved by the i.h.

    \end{itemize}
    \item Case $A = \fordis \alpha {A_1} {A_2}$:

    \begin{itemize}
      \item Case $B = \fordis \alpha {B_1} {B_2}$

      \item Case $B = B_1 \inter B_2$:
    \end{itemize}

    \item Case $A = A_1 \inter A_2$:

    \begin{itemize}
      \item Case $B = B_1 \inter B_2$: By \reflabel{\labeldisinterl} and by the i.h.
    \end{itemize}

  \end{itemize}
\end{proof}
